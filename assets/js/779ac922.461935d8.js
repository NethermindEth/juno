"use strict";(self.webpackChunkjuno_docs=self.webpackChunkjuno_docs||[]).push([[7371],{7504:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var t=i(4848),l=i(8453);const o={title:"Plugins"},r=void 0,s={id:"plugins",title:"Plugins",description:"Juno supports plugins that satisfy the JunoPlugin interface, enabling developers to extend and customize Juno's behaviour and functionality by dynamically loading external plugins during runtime.",source:"@site/versioned_docs/version-0.15.0/plugins.md",sourceDirName:".",slug:"/plugins",permalink:"/plugins",draft:!1,unlisted:!1,tags:[],version:"0.15.0",frontMatter:{title:"Plugins"},sidebar:"main",previous:{title:"Deploy on GCP",permalink:"/running-on-gcp"},next:{title:"JSON-RPC Interface",permalink:"/json-rpc"}},a={},u=[{value:"JunoPlugin Interface",id:"junoplugin-interface",level:2},{value:"Example plugin",id:"example-plugin",level:2},{value:"Building and loading the plugin",id:"building-and-loading-the-plugin",level:2},{value:"Running Juno with the plugin",id:"running-juno-with-the-plugin",level:2}];function c(n){const e={code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:["Juno supports plugins that satisfy the ",(0,t.jsx)(e.code,{children:"JunoPlugin"})," interface, enabling developers to extend and customize Juno's behaviour and functionality by dynamically loading external plugins during runtime."]}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.code,{children:"JunoPlugin"})," interface provides a structured way for plugins to interact with the blockchain by sending notifications when new blocks are added or reverted. This ensures state consistency, especially during blockchain reorganizations, while abstracting away the complexity of implementing block syncing and revert logic."]}),"\n",(0,t.jsx)(e.h2,{id:"junoplugin-interface",children:"JunoPlugin Interface"}),"\n",(0,t.jsxs)(e.p,{children:["Your plugin must implement the ",(0,t.jsx)(e.code,{children:"JunoPlugin"})," interface, which includes methods for initializing, shutting down, and handling new and reverted blocks."]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:"type JunoPlugin interface {\n\tInit() error\n\tShutdown() error\n\tNewBlock(block *core.Block, stateUpdate *core.StateUpdate, newClasses map[felt.Felt]core.Class) error\n\tRevertBlock(from, to *BlockAndStateUpdate, reverseStateDiff *core.StateDiff) error\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Init"}),": Called when the plugin is initialized. This can be used to set up database connections or any other necessary resources."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Shutdown"}),": Called when the Juno node is shut down. This can be used to clean up resources like database connections."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"NewBlock"}),": Triggered when a new block is synced by the Juno client. Juno will send the block, the corresponding state update, and any new classes. Importantly, Juno waits for the plugin to finish processing this function call before continuing. This ensures that the plugin completes its task before Juno proceeds with the blockchain sync."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"RevertBlock"}),": Called during a blockchain reorganization (reorg). Juno will invoke this method for each block that needs to be reverted. Similar to NewBlock, the client will wait for the plugin to finish handling the revert before moving on to the next block."]}),"\n",(0,t.jsx)(e.h2,{id:"example-plugin",children:"Example plugin"}),"\n",(0,t.jsxs)(e.p,{children:["Here is a basic example of a plugin that satisfies the ",(0,t.jsx)(e.code,{children:"JunoPlugin"})," interface:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'// go:generate go build -buildmode=plugin -o ../../build/plugin.so ./example.go\ntype examplePlugin string\n\n// Important: "JunoPluginInstance" needs to be exported for Juno to load the plugin correctly\nvar JunoPluginInstance examplePlugin\n\nvar _ junoplugin.JunoPlugin = (*examplePlugin)(nil)\n\nfunc (p *examplePlugin) Init() error {\n\tfmt.Println("ExamplePlugin initialized")\n\treturn nil\n}\n\nfunc (p *examplePlugin) Shutdown() error {\n\tfmt.Println("ExamplePlugin shutdown")\n\treturn nil\n}\n\nfunc (p *examplePlugin) NewBlock(block *core.Block, stateUpdate *core.StateUpdate, newClasses map[felt.Felt]core.Class) error {\n\tfmt.Println("ExamplePlugin NewBlock called")\n\treturn nil\n}\n\nfunc (p *examplePlugin) RevertBlock(from, to *junoplugin.BlockAndStateUpdate, reverseStateDiff *core.StateDiff) error {\n\tfmt.Println("ExamplePlugin RevertBlock called")\n\treturn nil\n}\n'})}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.code,{children:"JunoPluginInstance"})," variable must be exported for Juno to correctly load the plugin:\n",(0,t.jsx)(e.code,{children:"var JunoPluginInstance examplePlugin"})]}),"\n",(0,t.jsxs)(e.p,{children:["We ensure the plugin implements the ",(0,t.jsx)(e.code,{children:"JunoPlugin"})," interface, with the following line:\n",(0,t.jsx)(e.code,{children:"var _ junoplugin.JunoPlugin = (*examplePlugin)(nil)"})]}),"\n",(0,t.jsx)(e.h2,{id:"building-and-loading-the-plugin",children:"Building and loading the plugin"}),"\n",(0,t.jsx)(e.p,{children:"Once you have written your plugin, you can compile it into a shared object file (.so) using the following command:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-shell",children:"go build -buildmode=plugin -o ./plugin.so /path/to/your/plugin.go\n"})}),"\n",(0,t.jsxs)(e.p,{children:["This command compiles the plugin into a shared object file (",(0,t.jsx)(e.code,{children:"plugin.so"}),"), which can then be loaded by the Juno client using the ",(0,t.jsx)(e.code,{children:"--plugin-path"})," flag."]}),"\n",(0,t.jsx)(e.h2,{id:"running-juno-with-the-plugin",children:"Running Juno with the plugin"}),"\n",(0,t.jsxs)(e.p,{children:["Once your plugin has been compiled into a ",(0,t.jsx)(e.code,{children:".so"})," file, you can run Juno with your plugin by providing the ",(0,t.jsx)(e.code,{children:"--plugin-path"})," flag. This flag tells Juno where to find and load your plugin at runtime."]})]})}function d(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>s});var t=i(6540);const l={},o=t.createContext(l);function r(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:r(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);