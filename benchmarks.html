<!DOCTYPE html>
<html>
<head>
    <title>Juno Sync Benchmarks</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        .version-info {
            color: #666;
            margin-bottom: 20px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            color: #dc3545;
            padding: 20px;
            background: #f8d7da;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Juno Sync Benchmark Results</h1>
        <div class="version-info" id="versionInfo"></div>
        
        <div class="loading" id="loading">Loading benchmark data...</div>
        
        <div class="chart-container" style="display: none;" id="chartContainer">
            <canvas id="benchmarkChart"></canvas>
        </div>
        
        <div class="stats" id="stats"></div>
    </div>

    <script>
        async function loadAndDisplayBenchmarks() {
            try {
                const response = await fetch('benchmark-data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('chartContainer').style.display = 'block';
                
                data.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                const versions = [...new Set(data.map(d => d.version))];
                document.getElementById('versionInfo').textContent = 
                    `Latest version: ${versions[versions.length - 1]} | Total runs: ${data.length}`;
                
                const getDurationInSeconds = (dataPoint) => {
                    return dataPoint.duration_seconds;
                };
                
                const chartData = {
                    labels: data.map(d => d.version),
                    datasets: [{
                        label: 'Sync Duration',
                        data: data.map((d, index) => ({
                            x: index,
                            y: getDurationInSeconds(d),
                            originalData: d
                        })),
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                };
                
                const ctx = document.getElementById('benchmarkChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Sync Performance by Version (800,000 blocks)'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const seconds = context.parsed.y;
                                        return `Duration: ${formatDuration(seconds)}`;
                                    },
                                    afterLabel: function(context) {
                                        const index = context.dataIndex;
                                        return [
                                            `Timestamp: ${new Date(data[index].timestamp).toLocaleString()}`,
                                            `Block Target: ${data[index].block_target.toLocaleString()}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'category',
                                title: {
                                    display: true,
                                    text: 'Version'
                                },
                                ticks: {
                                    autoSkip: false,
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Duration'
                                },
                                ticks: {
                                    callback: function(value) {
                                        const days = Math.floor(value / (24 * 3600));
                                        const hours = Math.floor((value % (24 * 3600)) / 3600);
                                        const minutes = Math.floor((value % 3600) / 60);
                                        const seconds = Math.floor(value % 60);
                                        
                                        if (days > 0) {
                                            return `${days}d ${hours}h`;
                                        } else if (hours > 0) {
                                            return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                                        } else {
                                            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
                
                const durations = data.map(d => getDurationInSeconds(d));
                const avg = durations.reduce((a, b) => a + b, 0) / durations.length;
                const min = Math.min(...durations);
                const max = Math.max(...durations);
                const latest = durations[durations.length - 1];
                
                const formatDuration = (seconds) => {
                    const days = Math.floor(seconds / (24 * 3600));
                    const hours = Math.floor((seconds % (24 * 3600)) / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    const secs = Math.floor(seconds % 60);
                    
                    if (days > 0) {
                        return `${days} day${days > 1 ? 's' : ''}, ${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    } else if (hours > 0) {
                        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    } else {
                        return `${minutes}:${secs.toString().padStart(2, '0')}`;
                    }
                };
                
                const statsHtml = `
                    <div class="stat-card">
                        <div class="stat-value">${formatDuration(latest)}</div>
                        <div class="stat-label">Latest</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatDuration(avg)}</div>
                        <div class="stat-label">Average</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatDuration(min)}</div>
                        <div class="stat-label">Best</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatDuration(max)}</div>
                        <div class="stat-label">Worst</div>
                    </div>
                `;
                document.getElementById('stats').innerHTML = statsHtml;
                
            } catch (error) {
                console.error('Error loading benchmark data:', error);
                document.getElementById('loading').innerHTML = 
                    `<div class="error">Error loading benchmark data: ${error.message}</div>`;
            }
        }
        
        loadAndDisplayBenchmarks();
        setInterval(loadAndDisplayBenchmarks, 5 * 60 * 1000);
    </script>
</body>
</html> 